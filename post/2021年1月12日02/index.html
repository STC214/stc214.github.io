<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://stc214.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://stc214.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://stc214.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://stc214.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://stc214.github.io/css/light.css' />
    <link rel="stylesheet" href='https://stc214.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://stc214.github.io/css/syntax.css' />
    <title>给hugo增加搜索功能 - NOTE</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="原文： https://blog.humblepg.com/post/2019/06/hugo-search.html
Hugo 这种静态站点默认没有搜索功能，大概因为没了数据库实现反而不方便。Search for your Hugo Website 列出了一些可选项，要么自己生成索引用开源的工具搜索，要么用第三方搜索服务如 algolia。
其实 algolia 也是运营几年的熟脸，提供的免费方案小网站也够用，但是还是第三方依赖，配置的动作同样还是要做的，不如自己来。
自己来的方案里我选择 Github Gist for Fuse.js integration，因为它不需要另外引入 Node.js、 Grunt 或 Gulp，而是利用 Hugo 内置的功能在 build 的时候生成索引输出到 JSON，看起来更简单的样子。
以下内容参照以上链接，我重新演绎一下。
输出索引文件
第一步：修改配置文件 Config.toml，添加以下内容
[outputs] home = [&amp;#34;HTML&amp;#34;, &amp;#34;RSS&amp;#34;, &amp;#34;JSON&amp;#34;] 第二步：创建 layouts/_default/index.json
{{- $.Scratch.Add &amp;#34;index&amp;#34; slice -}} {{- range .Site.RegularPages -}} {{- $.Scratch.Add &amp;#34;index&amp;#34; (dict &amp;#34;title&amp;#34; .Title &amp;#34;tags&amp;#34; .Params.tags &amp;#34;categories&amp;#34; .Params.categories &amp;#34;contents&amp;#34; .Plain &amp;#34;permalink&amp;#34; .Permalink) -}} {{- end -}} {{- $.Scratch.Get &amp;#34;index&amp;#34; | jsonify -}} 完成后可以从 /index." />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://stc214.github.io/post/2021%E5%B9%B41%E6%9C%8812%E6%97%A502/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="给hugo增加搜索功能 - NOTE" />
<meta name="twitter:description"
  content="原文： https://blog.humblepg.com/post/2019/06/hugo-search.html
Hugo 这种静态站点默认没有搜索功能，大概因为没了数据库实现反而不方便。Search for your Hugo Website 列出了一些可选项，要么自己生成索引用开源的工具搜索，要么用第三方搜索服务如 algolia。
其实 algolia 也是运营几年的熟脸，提供的免费方案小网站也够用，但是还是第三方依赖，配置的动作同样还是要做的，不如自己来。
自己来的方案里我选择 Github Gist for Fuse.js integration，因为它不需要另外引入 Node.js、 Grunt 或 Gulp，而是利用 Hugo 内置的功能在 build 的时候生成索引输出到 JSON，看起来更简单的样子。
以下内容参照以上链接，我重新演绎一下。
输出索引文件
第一步：修改配置文件 Config.toml，添加以下内容
[outputs] home = [&amp;#34;HTML&amp;#34;, &amp;#34;RSS&amp;#34;, &amp;#34;JSON&amp;#34;] 第二步：创建 layouts/_default/index.json
{{- $.Scratch.Add &amp;#34;index&amp;#34; slice -}} {{- range .Site.RegularPages -}} {{- $.Scratch.Add &amp;#34;index&amp;#34; (dict &amp;#34;title&amp;#34; .Title &amp;#34;tags&amp;#34; .Params.tags &amp;#34;categories&amp;#34; .Params.categories &amp;#34;contents&amp;#34; .Plain &amp;#34;permalink&amp;#34; .Permalink) -}} {{- end -}} {{- $.Scratch.Get &amp;#34;index&amp;#34; | jsonify -}} 完成后可以从 /index." />
<meta name="twitter:site" content="https://stc214.github.io/" />
<meta name="twitter:creator" content="STC214" />
<meta name="twitter:image"
  content="https://stc214.github.io/img/0005.jpg">


<meta property="og:type" content="article" />
<meta property="og:title" content="给hugo增加搜索功能 - NOTE">
<meta property="og:description"
  content="原文： https://blog.humblepg.com/post/2019/06/hugo-search.html
Hugo 这种静态站点默认没有搜索功能，大概因为没了数据库实现反而不方便。Search for your Hugo Website 列出了一些可选项，要么自己生成索引用开源的工具搜索，要么用第三方搜索服务如 algolia。
其实 algolia 也是运营几年的熟脸，提供的免费方案小网站也够用，但是还是第三方依赖，配置的动作同样还是要做的，不如自己来。
自己来的方案里我选择 Github Gist for Fuse.js integration，因为它不需要另外引入 Node.js、 Grunt 或 Gulp，而是利用 Hugo 内置的功能在 build 的时候生成索引输出到 JSON，看起来更简单的样子。
以下内容参照以上链接，我重新演绎一下。
输出索引文件
第一步：修改配置文件 Config.toml，添加以下内容
[outputs] home = [&amp;#34;HTML&amp;#34;, &amp;#34;RSS&amp;#34;, &amp;#34;JSON&amp;#34;] 第二步：创建 layouts/_default/index.json
{{- $.Scratch.Add &amp;#34;index&amp;#34; slice -}} {{- range .Site.RegularPages -}} {{- $.Scratch.Add &amp;#34;index&amp;#34; (dict &amp;#34;title&amp;#34; .Title &amp;#34;tags&amp;#34; .Params.tags &amp;#34;categories&amp;#34; .Params.categories &amp;#34;contents&amp;#34; .Plain &amp;#34;permalink&amp;#34; .Permalink) -}} {{- end -}} {{- $.Scratch.Get &amp;#34;index&amp;#34; | jsonify -}} 完成后可以从 /index." />
<meta property="og:url" content="https://stc214.github.io/post/2021%E5%B9%B41%E6%9C%8812%E6%97%A502/" />
<meta property="og:site_name" content="给hugo增加搜索功能" />
<meta property="og:image"
  content="https://stc214.github.io/img/0005.jpg">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2021-01-12 23:15:58 &#43;0800 CST" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://stc214.github.io/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://stc214.github.io/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://stc214.github.io/">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://stc214.github.io/">
                  <img class=" avatar-user"
                    src="https://stc214.github.io/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://stc214.github.io/">STC214</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://stc214.github.io/post/2021%E5%B9%B41%E6%9C%8812%E6%97%A502/">给hugo增加搜索功能</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 12 Jan 2021 23:15:58 &#43;0800"
                    class="no-wrap">
                    Tue, 12 Jan 2021 23:15:58 &#43;0800</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Tue, 12 Jan 2021 23:15:58 &#43;0800"
                    class="no-wrap">
                    Tue, 12 Jan 2021 23:15:58 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      1243 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/note">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Note
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/%E7%AC%94%E8%AE%B0">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      笔记
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><p>原文： <a href="https://blog.humblepg.com/post/2019/06/hugo-search.html">https://blog.humblepg.com/post/2019/06/hugo-search.html</a></p>
<p>Hugo 这种静态站点默认没有搜索功能，大概因为没了数据库实现反而不方便。Search for your Hugo Website 列出了一些可选项，要么自己生成索引用开源的工具搜索，要么用第三方搜索服务如 algolia。</p>
<p>其实 algolia 也是运营几年的熟脸，提供的免费方案小网站也够用，但是还是第三方依赖，配置的动作同样还是要做的，不如自己来。</p>
<p>自己来的方案里我选择 Github Gist for Fuse.js integration，因为它不需要另外引入 Node.js、 Grunt 或 Gulp，而是利用 Hugo 内置的功能在 build 的时候生成索引输出到 JSON，看起来更简单的样子。</p>
<p>以下内容参照以上链接，我重新演绎一下。<br>
输出索引文件<br>
第一步：修改配置文件 Config.toml，添加以下内容</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">[outputs]  
</span></span><span class="line"><span class="cl">  home = [&#34;HTML&#34;, &#34;RSS&#34;, &#34;JSON&#34;]  
</span></span></code></pre></div><p>第二步：创建 layouts/_default/index.json</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span><span class="err">{-</span> <span class="err">$.Scratch.Add</span> <span class="nt">&#34;index&#34;</span> <span class="err">slice</span> <span class="err">-</span><span class="p">}</span><span class="err">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="err">{-</span> <span class="err">range</span> <span class="err">.Site.RegularPages</span> <span class="err">-</span><span class="p">}</span><span class="err">}</span>  
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="err">{-</span> <span class="err">$.Scratch.Add</span> <span class="nt">&#34;index&#34;</span> <span class="err">(dict</span> <span class="s2">&#34;title&#34;</span> <span class="err">.Title</span> <span class="s2">&#34;tags&#34;</span> <span class="err">.Params.tags</span> <span class="s2">&#34;categories&#34;</span> <span class="err">.Params.categories</span> <span class="s2">&#34;contents&#34;</span> <span class="err">.Plain</span> <span class="s2">&#34;permalink&#34;</span> <span class="err">.Permalink)</span> <span class="err">-</span><span class="p">}</span><span class="err">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="err">{-</span> <span class="err">end</span> <span class="err">-</span><span class="p">}</span><span class="err">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="err">{-</span> <span class="err">$.Scratch.Get</span> <span class="nt">&#34;index&#34;</span> <span class="err">|</span> <span class="err">jsonify</span> <span class="err">-</span><span class="p">}</span><span class="err">}</span>  
</span></span></code></pre></div><p>完成后可以从 /index.json 打开索引文件</p>
<p>注：layouts/ 目录里保存的是 Hugo 的模板文件。layouts/ 是站点级别的模板， themes/<!-- raw HTML omitted -->/layouts/ 是主题级别的模板，站点级别模板的设置优先于主题级别的模板。<br>
创建搜索页面<br>
第一步：创建 content/search.md</p>
<hr>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-md" data-lang="md"><span class="line"><span class="cl">title: &#34;Search Results&#34;  
</span></span><span class="line"><span class="cl">sitemap:  
</span></span><span class="line"><span class="cl">  priority : 0.1  
</span></span><span class="line"><span class="cl">layout: &#34;search&#34;  
</span></span><span class="line"><span class="cl">---  
</span></span></code></pre></div><p>根据 URL 规则，Hugo 会生成 /search/index.html 或 /search.html。但是因为 content/ 里的内容不支持插入 JS，所以此处的关键是 layout: &ldquo;search&rdquo; 指定模板文件，之后在模板文件中实现搜索功能。<br>
第二步：创建 layouts/_default/search.html</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">section</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{{ &#34;</span><span class="na">search</span><span class="err">&#34;</span> <span class="err">|</span> <span class="na">absURL</span> <span class="err">}}&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;search-query&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;s&#34;</span><span class="p">/&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;search-results&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">     <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Matching pages<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;search-result-template&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/x-js-template&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;summary-${key}&#34;</span><span class="o">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">h4</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;${link}&#34;</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/h4&gt;  </span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">snippet</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;  </span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">{</span> <span class="nx">isset</span> <span class="nx">tags</span> <span class="p">}</span><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Tags</span><span class="o">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">tags</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;${ end }  </span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">{</span> <span class="nx">isset</span> <span class="nx">categories</span> <span class="p">}</span><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Categories</span><span class="o">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">categories</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;${ end }  </span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/div&gt;  </span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://code.jquery.com/jquery-3.3.1.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ &#34;</span><span class="na">js</span><span class="err">/</span><span class="na">search</span><span class="err">.</span><span class="na">js</span><span class="err">&#34;</span> <span class="err">|</span> <span class="na">absURL</span> <span class="err">}}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span></code></pre></div><p>和原链相比去掉了 {{ define &ldquo;main&rdquo; }} … {{ end }} 之类的代码。</p>
<p>此处的 define 其实更像是 implement，或者说 define 这个 block 内的内容，而前提是你已经定义过这个 block。一般是在 Base Template 里，以 {{ block &ldquo;main&rdquo; . }} … {{ end }} 的格式定义。</p>
<p>这个例子是基于 Hugo Resume Theme，它在 layouts/_default/baseof.html 里定义了 block，而我使用的主题没有，结果就是直接使用原链的代码搜索页面会跳白板。</p>
<p>然后，没有 Base Template 可以引用的结果就是搜索界面比较丑，慢慢美化吧。</p>
<p>我就加个简单搜索功能，结果被迫学习了 Hugo 的模板布局“架构”，嗯，人间正道是沧桑。<br>
第三步：创建 static/js/search.js</p>
<p>这是具体实现搜索功能的 JS 函数，search.html 中被引用，照抄即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">summaryInclude=60;  
</span></span><span class="line"><span class="cl">var fuseOptions = {  
</span></span><span class="line"><span class="cl">  shouldSort: true,  
</span></span><span class="line"><span class="cl">  includeMatches: true,  
</span></span><span class="line"><span class="cl">  threshold: 0.0,  
</span></span><span class="line"><span class="cl">  tokenize:true,  
</span></span><span class="line"><span class="cl">  location: 0,  
</span></span><span class="line"><span class="cl">  distance: 100,  
</span></span><span class="line"><span class="cl">  maxPatternLength: 32,  
</span></span><span class="line"><span class="cl">  minMatchCharLength: 1,  
</span></span><span class="line"><span class="cl">  keys: [  
</span></span><span class="line"><span class="cl">    {name:&#34;title&#34;,weight:0.8},  
</span></span><span class="line"><span class="cl">    {name:&#34;contents&#34;,weight:0.5},  
</span></span><span class="line"><span class="cl">    {name:&#34;tags&#34;,weight:0.3},  
</span></span><span class="line"><span class="cl">    {name:&#34;categories&#34;,weight:0.3}  
</span></span><span class="line"><span class="cl">  ]  
</span></span><span class="line"><span class="cl">};  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">var searchQuery = param(&#34;s&#34;);  
</span></span><span class="line"><span class="cl">if(searchQuery){  
</span></span><span class="line"><span class="cl">  $(&#34;#search-query&#34;).val(searchQuery);  
</span></span><span class="line"><span class="cl">  executeSearch(searchQuery);  
</span></span><span class="line"><span class="cl">}else {  
</span></span><span class="line"><span class="cl">  $(&#39;#search-results&#39;).append(&#34;<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Please enter a word or phrase above<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>&#34;);  
</span></span><span class="line"><span class="cl">}  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">function executeSearch(searchQuery){  
</span></span><span class="line"><span class="cl">  $.getJSON( &#34;/index.json&#34;, function( data ) {  
</span></span><span class="line"><span class="cl">    var pages = data;  
</span></span><span class="line"><span class="cl">    var fuse = new Fuse(pages, fuseOptions);  
</span></span><span class="line"><span class="cl">    var result = fuse.search(searchQuery);  
</span></span><span class="line"><span class="cl">    console.log({&#34;matches&#34;:result});  
</span></span><span class="line"><span class="cl">    if(result.length &gt; 0){  
</span></span><span class="line"><span class="cl">      populateResults(result);  
</span></span><span class="line"><span class="cl">    }else{  
</span></span><span class="line"><span class="cl">      $(&#39;#search-results&#39;).append(&#34;<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>No matches found<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>&#34;);  
</span></span><span class="line"><span class="cl">    }  
</span></span><span class="line"><span class="cl">  });  
</span></span><span class="line"><span class="cl">}  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">function populateResults(result){  
</span></span><span class="line"><span class="cl">  $.each(result,function(key,value){  
</span></span><span class="line"><span class="cl">    var contents= value.item.contents;  
</span></span><span class="line"><span class="cl">    var snippet = &#34;&#34;;  
</span></span><span class="line"><span class="cl">    var snippetHighlights=[];  
</span></span><span class="line"><span class="cl">    var tags =[];  
</span></span><span class="line"><span class="cl">    if( fuseOptions.tokenize ){  
</span></span><span class="line"><span class="cl">      snippetHighlights.push(searchQuery);  
</span></span><span class="line"><span class="cl">    }else{  
</span></span><span class="line"><span class="cl">      $.each(value.matches,function(matchKey,mvalue){  
</span></span><span class="line"><span class="cl">        if(mvalue.key == &#34;tags&#34; || mvalue.key == &#34;categories&#34; ){  
</span></span><span class="line"><span class="cl">          snippetHighlights.push(mvalue.value);  
</span></span><span class="line"><span class="cl">        }else if(mvalue.key == &#34;contents&#34;){  
</span></span><span class="line"><span class="cl">          start = mvalue.indices[0][0]-summaryInclude&gt;0?mvalue.indices[0][0]-summaryInclude:0;  
</span></span><span class="line"><span class="cl">          end = mvalue.indices[0][1]+summaryInclude<span class="p">&lt;</span><span class="nt">contents.length</span><span class="err">?</span><span class="na">mvalue</span><span class="err">.</span><span class="na">indices</span><span class="err">[</span><span class="na">0</span><span class="err">][</span><span class="na">1</span><span class="err">]+</span><span class="na">summaryInclude:contents</span><span class="err">.</span><span class="na">length</span><span class="err">;</span>  
</span></span><span class="line"><span class="cl">          <span class="na">snippet</span> <span class="err">+=</span> <span class="na">contents</span><span class="err">.</span><span class="na">substring</span><span class="err">(</span><span class="na">start</span><span class="err">,</span><span class="na">end</span><span class="err">);</span>  
</span></span><span class="line"><span class="cl">          <span class="na">snippetHighlights</span><span class="err">.</span><span class="na">push</span><span class="err">(</span><span class="na">mvalue</span><span class="err">.</span><span class="na">value</span><span class="err">.</span><span class="na">substring</span><span class="err">(</span><span class="na">mvalue</span><span class="err">.</span><span class="na">indices</span><span class="err">[</span><span class="na">0</span><span class="err">][</span><span class="na">0</span><span class="err">],</span><span class="na">mvalue</span><span class="err">.</span><span class="na">indices</span><span class="err">[</span><span class="na">0</span><span class="err">][</span><span class="na">1</span><span class="err">]</span><span class="na">-mvalue</span><span class="err">.</span><span class="na">indices</span><span class="err">[</span><span class="na">0</span><span class="err">][</span><span class="na">0</span><span class="err">]+</span><span class="na">1</span><span class="err">));</span>  
</span></span><span class="line"><span class="cl">        <span class="err">}</span>  
</span></span><span class="line"><span class="cl">      <span class="err">});</span>  
</span></span><span class="line"><span class="cl">    <span class="err">}</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="na">if</span><span class="err">(</span><span class="na">snippet</span><span class="err">.</span><span class="na">length</span><span class="err">&lt;</span><span class="na">1</span><span class="err">){</span>  
</span></span><span class="line"><span class="cl">      <span class="na">snippet</span> <span class="err">+=</span> <span class="na">contents</span><span class="err">.</span><span class="na">substring</span><span class="err">(</span><span class="na">0</span><span class="err">,</span><span class="na">summaryInclude</span><span class="err">*</span><span class="na">2</span><span class="err">);</span>  
</span></span><span class="line"><span class="cl">    <span class="err">}</span>  
</span></span><span class="line"><span class="cl">    <span class="err">//</span><span class="na">pull</span> <span class="na">template</span> <span class="na">from</span> <span class="na">hugo</span> <span class="na">templarte</span> <span class="na">definition</span>  
</span></span><span class="line"><span class="cl">    <span class="na">var</span> <span class="na">templateDefinition </span><span class="o">=</span> <span class="s">$(&#39;#search-result-template&#39;).html();</span>  
</span></span><span class="line"><span class="cl">    <span class="err">//</span><span class="na">replace</span> <span class="na">values</span>  
</span></span><span class="line"><span class="cl">    <span class="na">var</span> <span class="na">output </span><span class="o">=</span> <span class="s">render(templateDefinition,{key:key,title:value.item.title,link:value.item.permalink,tags:value.item.tags,categories:value.item.categories,snippet:snippet});</span>  
</span></span><span class="line"><span class="cl">    <span class="err">$(&#39;#</span><span class="na">search-results</span><span class="err">&#39;).</span><span class="na">append</span><span class="err">(</span><span class="na">output</span><span class="err">);</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="err">$.</span><span class="na">each</span><span class="err">(</span><span class="na">snippetHighlights</span><span class="err">,</span><span class="na">function</span><span class="err">(</span><span class="na">snipkey</span><span class="err">,</span><span class="na">snipvalue</span><span class="err">){</span>  
</span></span><span class="line"><span class="cl">      <span class="err">$(&#34;#</span><span class="na">summary-</span><span class="err">&#34;+</span><span class="na">key</span><span class="err">).</span><span class="na">mark</span><span class="err">(</span><span class="na">snipvalue</span><span class="err">);</span>  
</span></span><span class="line"><span class="cl">    <span class="err">});</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="err">});</span>  
</span></span><span class="line"><span class="cl"><span class="err">}</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="na">function</span> <span class="na">param</span><span class="err">(</span><span class="na">name</span><span class="err">)</span> <span class="err">{</span>  
</span></span><span class="line"><span class="cl">    <span class="na">return</span> <span class="na">decodeURIComponent</span><span class="err">((</span><span class="na">location</span><span class="err">.</span><span class="na">search</span><span class="err">.</span><span class="na">split</span><span class="err">(</span><span class="na">name</span> <span class="err">+</span> <span class="err">&#39;=&#39;)[</span><span class="na">1</span><span class="err">]</span> <span class="err">||</span> <span class="err">&#39;&#39;).</span><span class="na">split</span><span class="err">(&#39;&amp;&#39;)[</span><span class="na">0</span><span class="err">]).</span><span class="na">replace</span><span class="err">(/\+/</span><span class="na">g</span><span class="err">,</span> <span class="err">&#39;</span> <span class="err">&#39;);</span>  
</span></span><span class="line"><span class="cl"><span class="err">}</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="na">function</span> <span class="na">render</span><span class="err">(</span><span class="na">templateString</span><span class="err">,</span> <span class="na">data</span><span class="err">)</span> <span class="err">{</span>  
</span></span><span class="line"><span class="cl">  <span class="na">var</span> <span class="na">conditionalMatches</span><span class="err">,</span><span class="na">conditionalPattern</span><span class="err">,</span><span class="na">copy</span><span class="err">;</span>  
</span></span><span class="line"><span class="cl">  <span class="na">conditionalPattern </span><span class="o">=</span> <span class="s">/\$\{\s*isset</span> <span class="err">([</span><span class="na">a-zA-Z</span><span class="err">]*)</span> <span class="err">\</span><span class="na">s</span><span class="err">*\}(.*)\$\{\</span><span class="na">s</span><span class="err">*</span><span class="na">end</span><span class="err">\</span><span class="na">s</span><span class="err">*}/</span><span class="na">g</span><span class="err">;</span>  
</span></span><span class="line"><span class="cl">  <span class="err">//</span><span class="na">since</span> <span class="na">loop</span> <span class="na">below</span> <span class="na">depends</span> <span class="na">on</span> <span class="na">re</span><span class="err">.</span><span class="na">lastInxdex</span><span class="err">,</span> <span class="na">we</span> <span class="na">use</span> <span class="na">a</span> <span class="na">copy</span> <span class="na">to</span> <span class="na">capture</span> <span class="na">any</span> <span class="na">manipulations</span> <span class="na">whilst</span> <span class="na">inside</span> <span class="na">the</span> <span class="na">loop</span>  
</span></span><span class="line"><span class="cl">  <span class="na">copy </span><span class="o">=</span> <span class="s">templateString;</span>  
</span></span><span class="line"><span class="cl">  <span class="na">while</span> <span class="err">((</span><span class="na">conditionalMatches </span><span class="o">=</span> <span class="s">conditionalPattern.exec(templateString))</span> <span class="err">!==</span> <span class="na">null</span><span class="err">)</span> <span class="err">{</span>  
</span></span><span class="line"><span class="cl">    <span class="na">if</span><span class="err">(</span><span class="na">data</span><span class="err">[</span><span class="na">conditionalMatches</span><span class="err">[</span><span class="na">1</span><span class="err">]]){</span>  
</span></span><span class="line"><span class="cl">      <span class="err">//</span><span class="na">valid</span> <span class="na">key</span><span class="err">,</span> <span class="na">remove</span> <span class="na">conditionals</span><span class="err">,</span> <span class="na">leave</span> <span class="na">contents</span><span class="err">.</span>  
</span></span><span class="line"><span class="cl">      <span class="na">copy </span><span class="o">=</span> <span class="s">copy.replace(conditionalMatches[0],conditionalMatches[2]);</span>  
</span></span><span class="line"><span class="cl">    <span class="err">}</span><span class="na">else</span><span class="err">{</span>  
</span></span><span class="line"><span class="cl">      <span class="err">//</span><span class="na">not</span> <span class="na">valid</span><span class="err">,</span> <span class="na">remove</span> <span class="na">entire</span> <span class="na">section</span>  
</span></span><span class="line"><span class="cl">      <span class="na">copy </span><span class="o">=</span> <span class="s">copy.replace(conditionalMatches[0],&#39;&#39;);</span>  
</span></span><span class="line"><span class="cl">    <span class="err">}</span>  
</span></span><span class="line"><span class="cl">  <span class="err">}</span>  
</span></span><span class="line"><span class="cl">  <span class="na">templateString </span><span class="o">=</span> <span class="s">copy;</span>  
</span></span><span class="line"><span class="cl">  <span class="err">//</span><span class="na">now</span> <span class="na">any</span> <span class="na">conditionals</span> <span class="na">removed</span> <span class="na">we</span> <span class="na">can</span> <span class="na">do</span> <span class="na">simple</span> <span class="na">substitution</span>  
</span></span><span class="line"><span class="cl">  <span class="na">var</span> <span class="na">key</span><span class="err">,</span> <span class="na">find</span><span class="err">,</span> <span class="na">re</span><span class="err">;</span>  
</span></span><span class="line"><span class="cl">  <span class="na">for</span> <span class="err">(</span><span class="na">key</span> <span class="na">in</span> <span class="na">data</span><span class="err">)</span> <span class="err">{</span>  
</span></span><span class="line"><span class="cl">    <span class="na">find </span><span class="o">=</span> <span class="s">&#39;\\$\\{\\s*&#39;</span> <span class="err">+</span> <span class="na">key</span> <span class="err">+</span> <span class="err">&#39;\\</span><span class="na">s</span><span class="err">*\\}&#39;;</span>  
</span></span><span class="line"><span class="cl">    <span class="na">re </span><span class="o">=</span> <span class="s">new</span> <span class="na">RegExp</span><span class="err">(</span><span class="na">find</span><span class="err">,</span> <span class="err">&#39;</span><span class="na">g</span><span class="err">&#39;);</span>  
</span></span><span class="line"><span class="cl">    <span class="na">templateString </span><span class="o">=</span> <span class="s">templateString.replace(re,</span> <span class="na">data</span><span class="err">[</span><span class="na">key</span><span class="err">]);</span>  
</span></span><span class="line"><span class="cl">  <span class="err">}</span>  
</span></span><span class="line"><span class="cl">  <span class="na">return</span> <span class="na">templateString</span><span class="err">;</span>  
</span></span><span class="line"><span class="cl"><span class="err">}</span>  
</span></span></code></pre></div><p>注：Hugo 的 static/ 目录存放需要应用的图片、CSS、JS 文件，build 时会直接生成于站点根目录。<br>
后</p>
<p>配置完成发现中文搜索有问题（中文分词问题，不奇怪），之后再慢慢研究吧。</p>
<p>这个例子使用的是 Fuse.js，但按照这个结构替换为其它 JS 库（Lunr.js …）也是可以的。</p>
<p><img src="/imgs/%E7%81%AB%E7%8B%90%E6%88%AA%E5%9B%BE_2021-01-12T15-26-41.308Z.png" alt="不完整的页面截图"></p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://stc214.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://stc214.github.io/css/toc.css' />

<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://stc214.github.io/css/gitalk.css'>
<script src='https://stc214.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'Your client ID',
    clientSecret: 'Your client secret',
    repo: 'stc214.github.io',
    owner: 'STC214',
    admin: ['STC214'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://stc214.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://stc214.github.io/js/github-style.js"></script>




</html>